<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oren Gamchi - Cyber Menu (ACTIVE GALLERY)</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;700;900&family=Heebo:wght@100;300;400;700;900&family=Orbitron:wght@500;700;900&family=Fira+Code:wght@400;500;700&family=Black+Ops+One&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- Vibe Coding Theme Variables --- */
        :root {
            --bg-dark: #050505;
            --card-bg: rgba(10, 10, 15, 0.98); 
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-primary: #8b5cf6;    /* Violet */
            --accent-secondary: #06b6d4; /* Cyan */
            --accent-highlight: #f43f5e; /* Rose */
            --border-color: rgba(139, 92, 246, 0.3); 
            --font-mono: 'Fira Code', monospace;
            --font-sans: 'Rubik', sans-serif;
            --font-tech-he: 'Heebo', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --font-stamp: 'Black Ops One', cursive;
            --danger: #ef4444;
            --success: #10b981;
        }

        * { box-sizing: border-box; }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: var(--font-sans);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            touch-action: none; 
            user-select: none;
            -webkit-font-smoothing: antialiased;
        }
        
        /* --- UTILS --- */
        .btn, .modal-content, .terminal, .credits-box {
            border-radius: 4px; 
            border: 1px solid var(--border-color);
            box-shadow: 0 0 5px rgba(139, 92, 246, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        /* --- ANIMATED CYBER BUTTONS --- */
        @keyframes cyber-slide-up {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .cyber-btn-animated {
            position: relative;
            overflow: hidden;
            opacity: 0; 
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: var(--font-mono);
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 100;
            will-change: transform, opacity;
            transform: translateZ(0);
        }
        
        .cyber-btn-animated.visible {
            animation: cyber-slide-up 0.5s ease-out forwards;
        }

        .cyber-btn-animated:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 5px var(--accent-primary);
        }
        
        /* --- LED TICKER BANNER --- */
        .led-ticker-wrap {
            position: fixed; top: 0; left: 0; width: 100%; height: 32px;
            background-color: #000; border-bottom: 1px solid var(--accent-secondary);
            z-index: 20000; 
            overflow: hidden; display: flex; align-items: center;
        }

        .led-ticker {
            display: flex; white-space: nowrap;
            animation: ticker 60s linear infinite; 
        }

        .led-item {
            padding: 0 40px; font-family: var(--font-mono); font-size: 12px;
            color: var(--accent-secondary); 
            display: flex; align-items: center; gap: 10px; letter-spacing: 1px;
        }

        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-50%, 0, 0); }
        }

        /* --- BACKGROUND --- */
        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: 
                linear-gradient(rgba(139, 92, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.1) 1px, transparent 1px);
            background-size: 60px 60px;
            transform: perspective(1000px) rotateX(60deg) translateY(-100px) translateZ(-500px) scale(3);
            opacity: 0.2;
            pointer-events: none;
        }

        /* --- 3D SCROLL ENGINE --- */
        .viewport-3d {
            position: fixed; top: 32px; left: 0; width: 100%; height: calc(100% - 32px);
            perspective: 1000px; overflow: hidden;
            z-index: 0; 
        }

        .stage-3d { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; }
        
        .page-slide-3d {
            position: absolute; top: 50%; left: 50%;
            width: 90vw; max-width: 1000px; min-height: 65vh; max-height: 85vh;
            background: #0a0a0f; 
            border: 1px solid rgba(139, 92, 246, 0.3);
            padding: 0;
            backface-visibility: hidden; 
            will-change: transform;
            display: flex; flex-direction: column;
            overflow: visible; 
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transform: translateZ(0); 
        }

        /* --- INDIVIDUAL SLIDE CYBER GRID --- */
        .slide-cyber-grid {
            position: absolute;
            top: 50%; left: 50%;
            width: 160%; height: 160%; 
            transform: translate(-50%, -50%) translateZ(-50px); 
            z-index: -1;
            pointer-events: none;
            border: 1px solid rgba(255,255,255,0.02);
            background-image: 
                linear-gradient(rgba(139, 92, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(circle, black 30%, transparent 70%);
            -webkit-mask-image: radial-gradient(circle, black 30%, transparent 70%);
        }

        /* Cyber Deco on Slides */
        .page-slide-3d::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
            z-index: 10;
        }
        .corner-deco {
            position: absolute; width: 20px; height: 20px;
            border: 2px solid var(--accent-secondary);
            z-index: 10; pointer-events: none;
        }
        .corner-tl { top: 10px; left: 10px; border-bottom: none; border-right: none; }
        .corner-br { bottom: 10px; right: 10px; border-top: none; border-left: none; }

        /* Inner Content - Allow Scroll */
        .slide-content-wrap {
            padding: 40px; height: 100%; overflow-y: auto; position: relative; z-index: 2;
            background: transparent; 
            touch-action: pan-y;
        }
        .slide-content-wrap::-webkit-scrollbar { width: 4px; }
        .slide-content-wrap::-webkit-scrollbar-thumb { background: var(--accent-primary); }

        /* --- HORIZONTAL MENU --- */
        .menu-scroll-container {
            display: flex;
            gap: 0;
            overflow-x: auto;
            padding: 0;
            /* Scroll snap removed for smooth auto-scroll */
            /* scroll-snap-type: x mandatory; */ 
            align-items: stretch;
            height: 100%;
            width: 100%;
            cursor: grab;
            touch-action: pan-x; /* CRITICAL FOR MOBILE SCROLLING */
            /* Hide scrollbar */
            scrollbar-width: none; 
            -ms-overflow-style: none;
            scroll-behavior: smooth; /* Enable native smooth scroll */
            pointer-events: auto;
        }
        .menu-scroll-container:active { cursor: grabbing; }
        .menu-scroll-container::-webkit-scrollbar { display: none; }

        .menu-card-wide {
            flex: 0 0 100%;
            width: 100%;
            background: transparent;
            border: none;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            scroll-snap-align: start; /* Kept for manual snap */
            backface-visibility: hidden;
        }
        
        .cooking-stat-row {
            display: flex; justify-content: space-around;
            padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); border-top: 1px solid rgba(255,255,255,0.1);
            margin: 15px 0;
            background: rgba(0,0,0,0.3);
        }
        .cooking-stat {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            font-family: var(--font-mono); font-size: 0.7rem; color: #ccc;
        }
        .neon-icon { font-size: 1.2rem; filter: none; } 
        .neon-icon.hot { color: var(--accent-highlight); }
        .neon-icon.time { color: var(--accent-secondary); }
        .neon-icon.tool { color: var(--accent-primary); }
        .neon-icon.heavy { color: var(--danger); } 

        .card-visual {
            height: 45%; width: 100%; position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--accent-primary);
            pointer-events: auto; 
            cursor: pointer;
            z-index: 10;
            backface-visibility: hidden;
        }
        .card-visual video {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(20%) contrast(1.1); transition: 0.3s; 
            pointer-events: none; 
        }
        .menu-card-wide:hover .card-visual video { filter: grayscale(0%); }
        
        .card-badge {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0,0,0,0.9); color: var(--accent-secondary);
            border: 1px solid var(--accent-secondary);
            padding: 6px 12px; font-family: var(--font-display); font-size: 0.8rem;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
            z-index: 5;
        }
        
        .card-stamp {
            position: absolute; top: 20px; left: 20px; z-index: 30;
            border: 2px solid var(--accent-highlight); color: var(--accent-highlight);
            font-family: var(--font-stamp); font-size: 1.5rem; padding: 4px 12px;
            text-transform: uppercase; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5); opacity: 0.9; pointer-events: none;
            mix-blend-mode: normal;
            background: rgba(0,0,0,0.5); border-radius: 4px;
        }

        .card-details { 
            padding: 20px 30px; flex-grow: 1; display: flex; flex-direction: column; 
            background: #0f0f12; 
        }
        
        .card-title-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .card-title { font-family: var(--font-display); font-size: 1.8rem; color: #fff; text-transform: uppercase; }
        
        /* Updated: Allow scrolling in text area */
        .card-desc { 
            font-size: 1rem; color: #aaa; line-height: 1.6; margin-bottom: 15px; flex-grow: 1; 
            font-family: var(--font-sans);
            overflow-y: auto; 
            touch-action: pan-y; 
        }
        
        .ingredients-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: auto; }
        .ing-tag {
            font-size: 0.8rem; padding: 6px 10px; border-radius: 4px;
            background: rgba(255,255,255,0.03); color: var(--accent-secondary);
            border: 1px solid rgba(6, 182, 212, 0.3); font-family: var(--font-mono);
        }

        /* --- MOBILE VIDEO LINK OVERLAY --- */
        .mobile-link-overlay {
            display: none;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.85);
            color: var(--accent-secondary);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            text-align: center;
            letter-spacing: 1px;
            border-top: 1px solid var(--accent-secondary);
            z-index: 20;
            pointer-events: none; 
        }

        /* Nav Arrows for Gallery */
        .gallery-nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(0,0,0,0.6); color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 20; transition: 0.3s;
            backdrop-filter: blur(4px);
            pointer-events: auto; /* Ensure clickable */
        }
        .gallery-nav-btn:hover { background: var(--accent-primary); color: #fff; }
        .gallery-prev { left: 10px; }
        .gallery-next { right: 10px; }

        /* --- STAMPS (Slide Overlay) --- */
        .stamp-overlay {
            position: absolute; z-index: 50; pointer-events: none; border: 4px solid var(--accent-secondary); color: var(--accent-secondary);
            font-family: var(--font-stamp); font-size: 3rem; padding: 5px 20px; text-transform: uppercase; letter-spacing: 3px;
            border-radius: 8px; transform-style: preserve-3d; white-space: nowrap;
            /* Removed glow shadow */
            opacity: 0;
            top: 30px; right: 30px; left: auto;
            transform: rotate(15deg);
        }
        .stamp-animate { animation: stamp-slam 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes stamp-slam {
            0% { transform: translateZ(500px) scale(2) rotate(15deg); opacity: 0; }
            100% { transform: translateZ(0) scale(1) rotate(15deg); opacity: 1; }
        }

        /* --- DAFKAZE 3D TITLE --- */
        .dafkaze-3d-title {
            font-family: 'Black Ops One', cursive; 
            font-size: clamp(4rem, 15vw, 8rem);
            font-weight: 900; line-height: 1; text-transform: uppercase; color: #fff;
            /* Solid hard shadow only, NO BLUR/GLOW */
            text-shadow: 2px 2px 0px #8b5cf6, 4px 4px 0px #6366f1, 6px 6px 0px rgba(0,0,0,0.5);
            transform-style: preserve-3d; margin-bottom: 10px;
        }

        /* --- UI OVERLAY --- */
        .ui-overlay { position: fixed; top: 40px; right: 0; left: 0; z-index: 20000; padding: 20px; pointer-events: none; }
        header { text-align: center; pointer-events: auto; }
        
        /* SCROLL INSTRUCTION */
        .scroll-instruction-container {
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 20000; pointer-events: none; 
            opacity: 0; transition: opacity 0.5s ease-in-out;
        }
        .scroll-instruction-container.visible { opacity: 1; }
        .scroll-mouse-icon {
            width: 24px; height: 40px;
            border: 2px solid var(--accent-secondary); border-radius: 12px;
            position: relative; margin-bottom: 5px; 
        }
        .scroll-mouse-wheel {
            width: 4px; height: 6px; background: #fff; border-radius: 2px;
            position: absolute; top: 8px; left: 50%; transform: translateX(-50%); animation: scroll-wheel 1.5s infinite;
        }
        .scroll-text-info { 
            font-family: var(--font-mono); font-size: 0.6rem; color: var(--accent-secondary); 
            text-transform: uppercase; letter-spacing: 1px; 
            white-space: nowrap; 
        }
        @keyframes scroll-wheel { 0% { top: 8px; opacity: 1; } 100% { top: 20px; opacity: 0; } }
        
        .slide-header { font-family: var(--font-display); font-size: 2rem; color: var(--accent-secondary); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 25px; direction: ltr; text-transform: uppercase; letter-spacing: 2px; }
        
        /* Table Styles */
        .cost-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; font-family: var(--font-mono); direction: ltr; }
        .cost-table td { padding: 15px; background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .cost-table th { color: var(--text-secondary); padding: 10px; text-align: left; }
        .total-row td { border-top: 1px solid var(--accent-secondary); color: var(--accent-secondary); font-weight: bold; }

        /* Formatting */
        .blink-zero { font-weight: bold; color: var(--accent-highlight); }
        
        .strike-red { text-decoration: line-through; color: var(--danger) !important; text-decoration-color: var(--danger); }
        .table-type-cursor::after { content: '|'; animation: blink-cursor 0.7s infinite; color: var(--accent-secondary); }
        @keyframes blink-cursor { 50% { opacity: 0; } }

        /* Glitch Text */
        .glitch-text { position: relative; display: inline-block; }
        .glitch-text { text-shadow: 2px 2px 0px var(--accent-primary); }

        /* --- FLAMES STYLES (ROTATED TO OTHER SIDE) --- */
        .cyber-flame-container {
            position: absolute;
            bottom: 20px;
            font-size: 6rem;
            color: var(--accent-highlight);
            /* Removed glow filter */
            opacity: 0.8;
            pointer-events: none;
            z-index: 1; /* Keep behind content */
        }
        /* Rotated outwards */
        .cyber-flame-left { left: 20px; transform: rotate(-15deg); animation: flame-flicker-left 2.5s infinite alternate ease-in-out; }
        .cyber-flame-right { right: 20px; transform: rotate(15deg); animation: flame-flicker-right 2.7s infinite alternate ease-in-out; }
        
        @keyframes flame-flicker-left { 0% { transform: rotate(-15deg) scale(1); opacity: 0.8; } 100% { transform: rotate(-15deg) scale(1.02); opacity: 0.9; } }
        @keyframes flame-flicker-right { 0% { transform: rotate(15deg) scale(1); opacity: 0.8; } 100% { transform: rotate(15deg) scale(1.02); opacity: 0.9; } }

        /* --- SIDE ICONS (Intro & Charts) --- */
        .side-icon-container {
            flex: 0 0 auto;
            font-size: 4rem;
            opacity: 0.8;
            filter: none;
            animation: pulse-side 4s infinite ease-in-out;
            transition: transform 0.5s ease;
        }
        @keyframes pulse-side { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }

        /* --- NEW HUGE CYBER CHARTS (Slide 03) --- */
        .cyber-chart-large {
            font-size: 12rem; 
            color: rgba(6, 182, 212, 0.2); 
            text-shadow: 2px 2px 0px rgba(139, 92, 246, 0.5); 
            animation: chart-float 8s ease-in-out infinite;
            flex: 0 0 auto;
            transition: transform 0.5s ease;
        }
        @keyframes chart-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }
        
        /* --- IDLE POPOUT ANIMATION --- */
        @keyframes idle-pop-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.25); } 
        }
        .idle-pop {
            animation: idle-pop-bounce 1s ease-in-out infinite !important;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .page-slide-3d { width: 95vw; min-height: 75vh; }
            .slide-content-wrap { padding: 25px 15px 40px 15px; } 
            .stamp-overlay { font-size: 2rem; top: 10px; right: 10px; }
            .slide-header { font-size: 1.5rem; text-align: center; }
            .dafkaze-3d-title { font-size: 3rem; text-align: center; width: 100%; margin: 0 auto; }
            .card-title { font-size: 1.4rem; }
            
            /* --- UPDATED MOBILE LAYOUT FOR MENU CARDS --- */
            .menu-card-wide {
                flex-direction: column;
                height: 100%;
                min-height: 60vh;
            }
            .card-visual {
                width: 100%;
                height: 35%; 
                min-height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--accent-primary);
            }
            .mobile-link-overlay {
                display: block !important;
            }
            .card-details {
                width: 100%;
                height: auto;
                flex-grow: 1;
                padding: 15px;
                display: flex;
                flex-direction: column;
                overflow: visible; 
            }
            .card-desc {
                font-size: 0.9rem;
                max-height: 150px; 
                margin-bottom: 10px;
            }
            .card-details > div:last-child {
                margin-top: auto;
                padding-top: 10px;
            }
            .card-details .btn {
                z-index: 50; 
                position: relative;
            }
            
            .side-icon-container { font-size: 2.5rem; display: block; margin: 10px; }
            .cyber-chart-large { font-size: 5rem; display: block; margin: 10px; }
            .cutlery-icon { font-size: 4rem; }

            .cyber-flame-container { font-size: 4rem; bottom: 10px; } 
        }
        
        /* Desktop */
        @media (min-width: 900px) {
            .menu-card-wide { flex-direction: row; }
            .card-visual { width: 50%; height: 100%; border-bottom: none; border-right: 1px solid var(--accent-primary); }
            .card-details { width: 50%; justify-content: center; }
        }
        
        /* --- CUTLERY ANIMATION --- */
        @keyframes cutting-motion {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) translateX(-3px); } 
            50% { transform: rotate(0deg) scale(1.05); }
            75% { transform: rotate(10deg) translateX(3px); }
            100% { transform: rotate(0deg) scale(1); }
        }
        .cutlery-icon {
            color: var(--accent-highlight); 
            filter: none;
            animation: cutting-motion 3s ease-in-out infinite;
            display: inline-block;
        }
    </style>
</head>
<body ondblclick="handleDoubleTap()">

    <div class="bg-grid"></div>
    
    <!-- LED TICKER (Fixed Top - Z: 20000) -->
    <div class="led-ticker-wrap">
        <div class="led-ticker">
            <div class="led-item">:: SYSTEM STATUS: ONLINE :: MENU LOADED :: CHEF: OREN GAMCHI :: TODAY'S SPECIALS: AI GENERATED ::</div>
            <div class="led-item">:: SYSTEM STATUS: ONLINE :: MENU LOADED :: CHEF: OREN GAMCHI :: TODAY'S SPECIALS: AI GENERATED ::</div>
        </div>
    </div>

    <!-- 3D VIEWPORT (Base Z: 0) -->
    <div class="viewport-3d">
        <div class="stage-3d" id="stage-3d"></div>
    </div>

    <!-- UI (Fixed Header - Z: 20000) -->
    <div class="ui-overlay">
        <header>
            <div class="font-mono text-slate-500 text-[10px] mt-1 tracking-widest">EST. 2026 // INFINITE FLAVORS</div>
        </header>
    </div>
    
    <!-- SCROLL INSTRUCTION (Fixed Bottom - Z: 20000) -->
    <div id="scroll-instruction" class="scroll-instruction-container">
        <div class="scroll-mouse-icon">
            <div class="scroll-mouse-wheel"></div>
        </div>
        <div class="scroll-text-info">SCROLL</div>
    </div>

    <!-- MODAL (Topmost - Z: 30000) -->
    <div id="cv-modal" class="modal-overlay" onclick="if(event.target.id === 'cv-modal') closeModal('cv-modal')" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:30000; justify-content:center; align-items:center;">
        <div class="modal-content" dir="rtl" style="width:90%; max-width:600px; background:#111; border:1px solid #333; padding:20px; position:relative; overflow-y: auto; max-height: 90vh;">
            <div class="modal-close" onclick="closeModal('cv-modal')" style="color:#fff; position:absolute; top:10px; left:10px; cursor:pointer;"><i class="fa-solid fa-xmark"></i></div>
            <h2 class="font-mono text-xl text-cyan-400 border-b border-gray-800 pb-2 mb-4" dir="ltr">CHEF'S_RESUME.log</h2>
            <div style="font-family: var(--font-mono); line-height: 1.6; color: #ccc;">
                 <p class="mb-2"><span style="color:var(--accent-highlight)">> CURRENT ROLE:</span> Tech Artist & AI Chef</p>
                 <p class="mb-2"><span style="color:var(--accent-secondary)">> EXP:</span> 10+ Years Legacy / 3+ Years AI</p>
                 <p class="mb-4"><span style="color:var(--accent-primary)">> SPECIALTY:</span> WebGL, React, Physics Engines</p>
                 <hr style="border-color:#333; margin: 15px 0;">
                 <p>מבשל חוויות דיגיטליות על אש גבוהה. עברתי מעיצוב ידני לאוטומציה מלאה.</p>
                 <br>
                 <p>ניסיון נוסף:</p>
                 <ul>
                     <li>פיתוח ממשקי משתמש מורכבים</li>
                     <li>אנימציות תלת מימד ב-Three.js</li>
                     <li>שילוב AI בתהליכי עבודה קריאייטיביים</li>
                 </ul>
            </div>
             <div style="text-align:center; margin-top:20px;">
                 <div class="btn" style="border:1px solid var(--danger); color:var(--danger); display:inline-block; padding:5px 15px; cursor:pointer;" onclick="closeModal('cv-modal')">CLOSE</div>
            </div>
        </div>
    </div>

    <script>
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- Data (Menu Items) ---
        const galleryBaseUrl = "https://firebasestorage.googleapis.com/v0/b/portfolioflow-8qrng.firebasestorage.app/o/video%2Fthumbs_video%2F";
        
        const galleryFiles = [
            { f: "THUMB__KISHKASHTA.mp4", t: "Kishkashta", u: "https://dafkaze.com/projects/kishkashta", tech: "SVG, Storytelling", time: "24h", spice: 2, desc: "A nostalgic journey through classic storytelling utilizing vector graphics and smooth animations.", stamp: "CLASSIC", weight: 1 },
            { f: "THUMB_fishy.mp4", t: "Fishy News", u: "https://dafkaze.com/projects/fishy-news", tech: "News API, Canvas", time: "12h", spice: 3, desc: "Real-time news aggregator visualized as an underwater ecosystem. Fish swim based on trends.", stamp: "LIVE_DATA", weight: 2 },
            { f: "THUMB_CITY.mp4", t: "City Timelapse", u: "https://dafkaze.com/projects/city-timelapse", tech: "Midjourney, Frame Interpolation", time: "8h", spice: 4, desc: "AI-generated urban evolution. Thousands of synthetic frames blended into a coherent timeline.", stamp: "SYNTHETIC", weight: 3 },
            { f: "THUMB_knesset.mp4", t: "AI Knesset", u: "https://dafkaze.com/projects/ai-knesset", tech: "Generative Audio, React", time: "48h", spice: 5, desc: "Satirical simulation using voice synthesis to generate endless debates between AI politicians.", stamp: "SATIRE", weight: 2 },
            { f: "thumb_globe.mp4", t: "Globe Gallery", u: "https://dafkaze.com/projects/globe-gallery", tech: "Three.js, Shaders", time: "36h", spice: 3, desc: "Interactive 3D globe visualization plotting digital assets across physical coordinates.", stamp: "GLOBAL", weight: 3 },
            { f: "THUMB_GROVEBOX.mp4", t: "Grovebox", u: "https://dafkaze.com/projects/grove-box", tech: "Physics, Interactive Audio", time: "18h", spice: 2, desc: "Musical sandbox where physics collisions trigger generative soundscapes.", stamp: "PHYSICS", weight: 2 },
            { f: "thumb_blackhole.mp4", t: "Blackhole Sim", u: "https://dafkaze.com/projects/black-hole-simulator", tech: "GLSL Shaders, Math", time: "∞", spice: 5, desc: "Raymarching experiment simulating gravitational lensing around a singularity.", stamp: "VOID", weight: 3 },
            { f: "thumb_gallery.mp4", t: "Cyber Gallery", u: "https://dafkaze.com/projects/cyber-gallery", tech: "3D DOM, CSS3D", time: "16h", spice: 2, desc: "Immersive 3D gallery space built entirely with CSS transformations and DOM elements.", stamp: "CSS_3D", weight: 2 },
            { f: "thumb_like_machine.mp4", t: "Like Machine", u: "https://dafkaze.com/projects/like-machine", tech: "Social API, Particles", time: "10h", spice: 1, desc: "Visual commentary on social media dopamine loops using particle systems.", stamp: "DOPAMINE", weight: 1 },
            { f: "thumb_segmentation.mp4", t: "RT Segmentation", u: "https://dafkaze.com/projects/rt-segmentation", tech: "TensorFlow.js, Webcam", time: "32h", spice: 4, desc: "Browser-based computer vision removing backgrounds in real-time video streams.", stamp: "VISION", weight: 3 },
            { f: "thumb_wow_screen.mp4", t: "Wow Screen", u: "https://dafkaze.com/projects/interactive-webcam", tech: "Motion Detection, Filters", time: "14h", spice: 2, desc: "Interactive mirror installation applying digital filters based on user movement.", stamp: "MOTION", weight: 3 },
            { f: "THUMB__ANTS.mp4", t: "Ant Colony", u: "https://dafkaze.com/projects/ant-colony-simulation", tech: "Emergent Behavior, Canvas", time: "40h", spice: 5, desc: "Complex simulation of ant pheromone trails and emergent swarm intelligence.", stamp: "COLONY", weight: 3 },
            { f: "THUMB_pegs.mp4", t: "Pegs", u: "https://dafkaze.com/projects/peg-solitaire-game", tech: "Game Logic, Logic", time: "6h", spice: 1, desc: "Classic puzzle game implementation with polished UI and state management.", stamp: "LOGIC", weight: 1 },
            { f: "thumb_bg_maker.mp4", t: "Bg Maker", u: "https://dafkaze.com/projects/blue-white-app", tech: "Canvas API, Generators", time: "8h", spice: 2, desc: "Tool for generating procedural abstract backgrounds for national holidays.", stamp: "GEN_ART", weight: 1 }
        ];

        // --- Bill Data for Animation ---
        const billData = [
            { item: "Adobe Suite", legacy: 720, price: 0, isMoney: true },
            { item: "Wix Subscription", legacy: 324, price: 0, isMoney: true },
            { item: "Unity Pro", legacy: 2040, price: 0, isMoney: true },
            { item: "Dev Time", legacy: 200, price: 20, isMoney: false, suffix: 'h' },
            { item: "Creativity", legacy: "High", price: "Unbound", isText: true }
        ];

        const pageSlides = [
            // SLIDE 0: INTRO
            {
                title: "00_WELCOME",
                stamp: "OPEN",
                content: `
                    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; text-align:center; position:relative;">
                        <div style="font-size: 5rem; margin-bottom: 20px; display: flex; gap: 30px;">
                            <i class="fa-solid fa-utensils cutlery-icon"></i>
                        </div>
                        <h1 class="dafkaze-3d-title">DAFKAZE</h1>
                        <h2 class="glitch-text" data-text="CYBER BISTRO" style="font-family:var(--font-display); font-size:clamp(1.5rem, 4vw, 2.5rem); margin-bottom:10px; color:var(--text-secondary); letter-spacing:4px;">CYBER BISTRO</h2>
                        <div class="type-me" style="font-family: var(--font-tech-he); font-weight: 300; font-size: 1.2rem; color:#888; max-width:500px; line-height: 1.6;">
                            ברוכים הבאים למסעדה הדיגיטלית שלי.<br>
                            כל מנה בתפריט היא קוד טהור, מוגשת רותחת היישר מה-GPU.<br>
                            אין צורך להשאיר טיפ.
                        </div>
                        
                        <!-- MAIN SITE BUTTON -->
                        <div style="margin-top: 30px;">
                            <a href="https://dafkaze.com" target="_blank" class="btn cyber-btn-animated" style="background:var(--accent-secondary); color:#000; font-weight:bold; padding: 12px 24px; text-decoration:none;">
                                <i class="fa-solid fa-utensils"></i> MAIN SITE
                            </a>
                        </div>
                    </div>
                `
            },
            // SLIDE 1: CHEF PROFILE
            {
                title: "01_THE_CHEF",
                stamp: "MASTER",
                content: `
                    <div style="display:flex; align-items:center; justify-content:center; height:100%; gap: 40px; flex-wrap: wrap;">
                        <div class="side-icon-container">
                            <i class="fa-solid fa-mobile-screen-button" style="color: var(--accent-secondary);"></i>
                        </div>
                        <div style="display:flex; flex-direction:column; align-items:center;">
                            <div style="width:120px; height:120px; border-radius:50%; border:3px solid var(--accent-primary); overflow:hidden; margin-bottom:20px; box-shadow:0 0 20px rgba(139, 92, 246, 0.5);">
                                <img src="https://firebasestorage.googleapis.com/v0/b/portfolioflow-8qrng.firebasestorage.app/o/oren_pics%2Foren_pics_masters%2Foren%20blue.png?alt=media" style="width:100%; height:100%; object-fit:cover;">
                            </div>
                            <h3 style="font-family:var(--font-display); font-size:2rem;">OREN GAMCHI</h3>
                            <div style="font-family:var(--font-mono); color:var(--accent-secondary); margin-bottom:20px;">HEAD CHEF & ARCHITECT</div>
                            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:8px; max-width:400px; text-align:center; font-family:var(--font-sans);">
                                <p class="type-me">"אני מבשל קוד ברכבת. מחליף סכינים במקלדות, ורכיבים בפיקסלים. המטרה שלי היא ליצור חוויות שמשאירות טעם של עוד."</p>
                            </div>
                            
                            <!-- RESUME BUTTON -->
                            <div style="margin-top: 20px;">
                                <a href="#" onclick="openModal('cv-modal'); return false;" class="btn cyber-btn-animated" style="background:var(--accent-primary); color:#fff; padding: 12px 24px; text-decoration:none;">
                                    <i class="fa-solid fa-receipt"></i> RESUME
                                </a>
                            </div>
                        </div>
                        <div class="side-icon-container">
                            <i class="fa-solid fa-laptop-code" style="color: var(--accent-primary);"></i>
                        </div>
                    </div>
                `
            },
            // SLIDE 2: THE MENU
            {
                title: "02_MAIN_COURSES",
                stamp: "", 
                content: `
                    <div class="type-me" style="color:#888; margin-bottom:10px; font-family:var(--font-mono); text-align:center; font-size:0.8rem; opacity:0.7;">
                        /// DRAG LEFT/RIGHT OR USE ARROWS ///
                    </div>
                    <div style="position:relative; width:100%; flex-grow:1; overflow:hidden;">
                        <div class="gallery-nav-btn gallery-prev" onclick="scrollGallery(-1)"><i class="fa-solid fa-chevron-left"></i></div>
                        <div class="gallery-nav-btn gallery-next" onclick="scrollGallery(1)"><i class="fa-solid fa-chevron-right"></i></div>
                        <div id="menu-scroll-container" class="menu-scroll-container"></div>
                    </div>
                `
            },
            // SLIDE 3: COST ANALYSIS
            {
                title: "03_THE_BILL",
                stamp: "PAID",
                content: `
                    <div style="display:flex; align-items:center; justify-content:center; height:100%; gap:20px;">
                        <i class="fa-solid fa-chart-simple cyber-chart-large"></i>
                        <div style="max-width:600px; width:100%; z-index:10;">
                            <div class="terminal" style="padding:20px; background:rgba(0,0,0,0.8);">
                                <div style="text-align:center; border-bottom:1px dashed #555; padding-bottom:10px; margin-bottom:15px; font-family:var(--font-mono);">
                                    RECEIPT #90210<br>SERVER: AI_AGENT_007
                                </div>
                                <table class="cost-table">
                                    <thead><tr><th>ITEM</th><th>LEGACY COST</th><th>OUR PRICE</th></tr></thead>
                                    <tbody id="bill-table-body"></tbody>
                                    <tfoot id="bill-table-foot" style="display:none;">
                                        <tr class="total-row"><td>TOTAL SAVINGS</td><td></td><td class="blink-infinite">100%</td></tr>
                                    </tfoot>
                                </table>
                                <div style="text-align:center; margin-top:20px; font-family:var(--font-display); font-size:0.8rem; color:#666;">THANK YOU FOR DINING WITH US</div>
                            </div>
                        </div>
                        <i class="fa-solid fa-chart-pie cyber-chart-large"></i>
                    </div>
                `
            },
            // SLIDE 4: CONTACT
            {
                title: "04_FEEDBACK",
                stamp: "WRITE_US",
                content: `
                    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; position:relative;">
                        <div class="cyber-flame-container cyber-flame-left"><i class="fa-solid fa-fire"></i></div>
                        <div class="cyber-flame-container cyber-flame-right"><i class="fa-solid fa-fire"></i></div>
                        
                        <div style="position:relative; z-index:10; display:flex; flex-direction:column; align-items:center;">
                            <i class="fa-solid fa-comment-dots" style="font-size:3rem; color:var(--accent-highlight); margin-bottom:20px;"></i>
                            <h3 style="font-family:var(--font-display); font-size:1.8rem; margin-bottom:10px;">COMPLIMENTS TO THE CHEF?</h3>
                            <p class="type-me" style="text-align:center; color:#ccc; max-width:500px; margin-bottom:30px;">
                                אהבתם את האוכל? יש לכם רעיון למנה חדשה? אני זמין לשיתופי פעולה, פרויקטים, או סתם קפה וקוד.
                            </p>
                            <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;">
                                <a href="mailto:ORENREDE@GMAIL.COM" class="btn" style="padding:10px 25px; background:rgba(255,255,255,0.1); color:#fff; text-decoration:none;"><i class="fa-solid fa-envelope"></i> EMAIL</a>
                                <a href="https://linkedin.com/in/orengamchi" target="_blank" class="btn" style="padding:10px 25px; background:var(--accent-secondary); color:#000; text-decoration:none;"><i class="fa-brands fa-linkedin"></i> LINKEDIN</a>
                                <a href="https://facebook.com/orengamchi" target="_blank" class="btn" style="padding:10px 25px; background:#3b5998; color:#fff; border:none; text-decoration:none;"><i class="fa-brands fa-facebook"></i> FACEBOOK</a>
                            </div>
                        </div>
                    </div>
                `
            }
        ];

        // --- INFINITE SCROLL ENGINE ---
        let virtualScroll = 0;
        let currentSlideIndex = 0; 
        const spacing = 1200; 
        const totalSlides = pageSlides.length;
        const loopDistance = spacing * totalSlides;
        
        let isScrollLocked = false;
        let lastTouchTime = 0;
        let startX, scrollLeft;
        let billAnimationPlayed = false;

        function renderMenu(container) {
            // 1. Triple Data for Infinite Loop
            const infiniteFiles = [...galleryFiles, ...galleryFiles, ...galleryFiles];

            const createCardHtml = (item) => {
                 const spiceLevel = Array(item.spice).fill('<i class="fa-solid fa-pepper-hot neon-icon hot"></i>').join(' ');
                 const rot = Math.floor(Math.random() * 20) - 10;
                 
                 let hardwareIcon = '';
                 if(item.tech.toLowerCase().includes('audio') || item.tech.toLowerCase().includes('voice')) {
                     hardwareIcon = '<i class="fa-solid fa-microphone-lines neon-icon tool" title="Audio Input"></i><span>VOICE</span>';
                 } else if (item.tech.toLowerCase().includes('webcam') || item.tech.toLowerCase().includes('vision') || item.tech.toLowerCase().includes('tensorflow')) {
                     hardwareIcon = '<i class="fa-solid fa-video neon-icon tool" title="Camera Input"></i><span>VISION</span>';
                 } else {
                     hardwareIcon = '<i class="fa-solid fa-keyboard neon-icon tool" title="Keyboard/Mouse"></i><span>INPUT</span>'; 
                 }

                 let heavyIcon = '';
                 if(item.weight >= 3) {
                     heavyIcon = `<div class="cooking-stat"><i class="fa-solid fa-weight-hanging neon-icon heavy" title="Heavy Computational Load"></i><span>HEAVY</span></div>`;
                 }

                 return `
                    <div class="menu-card-wide">
                        <div class="card-visual" data-url="${item.u}">
                            <div class="card-badge">OPEN 24/7</div>
                            <div class="card-stamp" style="transform: rotate(${rot}deg);">${item.stamp || 'APPROVED'}</div>
                            <video autoplay loop muted playsinline><source src="${galleryBaseUrl}${item.f}?alt=media"></video>
                            
                            <div class="mobile-link-overlay">
                                <i class="fa-solid fa-rocket"></i> LAUNCH PROTOCOL
                            </div>
                        </div>
                        <div class="card-details">
                            <div class="card-title-row"><span class="card-title">${item.t}</span></div>
                            <div class="cooking-stat-row">
                                 <div class="cooking-stat"><i class="fa-solid fa-stopwatch neon-icon time"></i><span>${item.time} PREP</span></div>
                                 <div class="cooking-stat">${hardwareIcon}</div>
                                 <div class="cooking-stat"><div>${spiceLevel}</div><span>SPICE LVL</span></div>
                                 ${heavyIcon}
                            </div>
                            <div class="card-desc">${item.desc}</div>
                            
                            <div style="display:flex; justify-content:space-between; align-items:end; margin-top:auto;">
                                <div class="ingredients-tags" style="margin-top:0;">${item.tech.split(',').map(t => `<span class="ing-tag">${t.trim()}</span>`).join('')}</div>
                                <a href="${item.u}" target="_blank" class="btn" style="background:var(--accent-secondary); color:#000; padding:8px 12px; font-weight:bold; font-family:var(--font-mono); font-size:0.8rem; text-decoration:none; margin-right:auto; margin-left:10px;">
                                    LAUNCH <i class="fa-solid fa-rocket"></i>
                                </a>
                            </div>

                        </div>
                    </div>
                `;
            };
            
            const html = infiniteFiles.map(item => createCardHtml(item)).join('');
            container.innerHTML = html;
            
            // 2. Set Initial Scroll to Middle Set (after small delay for layout)
            setTimeout(() => {
                // Calculate single set width
                const totalWidth = container.scrollWidth;
                const singleSetWidth = totalWidth / 3;
                
                // Initialize in the middle set
                container.scrollLeft = singleSetWidth; 
                
                // 3. Infinite Scroll Teleport Logic
                container.addEventListener('scroll', () => {
                    const scrollPos = container.scrollLeft;
                    const setW = container.scrollWidth / 3;
                    
                    // Buffer zone to prevent flickering at edges (5px)
                    if (scrollPos < 10) { 
                        // If we hit start of Set 1, jump to start of Set 2
                        container.scrollLeft = setW + 10;
                    } 
                    else if (scrollPos > setW * 2 + setW - container.clientWidth - 10) {
                        // If we hit end of Set 3, jump to end of Set 2
                        container.scrollLeft = setW * 2 - container.clientWidth - 10;
                    }
                });
                
                // Start auto scroll (slowly)
                startAutoScroll(container);
                
            }, 500); // Give layout time to settle
            
            // --- Custom Drag/Click Logic ---
            let isDown = false;
            let startMouseX;
            let startScrollLeft;
            let dragThreshold = 5;
            let hasMoved = false;

            container.addEventListener('mousedown', (e) => {
                // Stop propagation so global 3D scroll doesn't trigger
                e.stopPropagation();
                isDown = true;
                hasMoved = false;
                startMouseX = e.pageX - container.offsetLeft;
                startScrollLeft = container.scrollLeft;
                container.style.cursor = 'grabbing';
            });

            container.addEventListener('mouseleave', () => {
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mouseup', (e) => {
                e.stopPropagation();
                isDown = false;
                container.style.cursor = 'grab';
            });

            container.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                e.stopPropagation();
                const x = e.pageX - container.offsetLeft;
                const walk = (x - startMouseX) * 2; 
                if (Math.abs(walk) > dragThreshold) hasMoved = true;
                container.scrollLeft = startScrollLeft - walk;
            });

            const videoCards = container.querySelectorAll('.card-visual');
            videoCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!hasMoved) {
                        const url = card.getAttribute('data-url');
                        if(url) window.open(url, '_blank');
                    }
                });
            });
        }
        
        // Auto Scroll Function
        function startAutoScroll(container) {
            let autoScrollSpeed = 0.5; // Slow speed
            let isHovering = false;
            
            function step() {
                if (!isHovering) {
                    container.scrollLeft += autoScrollSpeed;
                }
                requestAnimationFrame(step);
            }
            
            // Interaction listeners to pause auto scroll
            container.addEventListener('mouseenter', () => isHovering = true);
            container.addEventListener('mouseleave', () => isHovering = false);
            container.addEventListener('touchstart', () => isHovering = true);
            container.addEventListener('touchend', () => setTimeout(() => isHovering = false, 2000));
            
            step();
        }

        // --- NEW: FIXED ARROW SCROLLING ---
        function scrollGallery(dir) {
            const container = document.getElementById('menu-scroll-container');
            if(container) {
                // Determine scroll amount: either container width or card width
                // For safety, scroll by container width so it feels like "Next Page"
                const scrollAmount = container.clientWidth;
                container.scrollBy({ left: dir * scrollAmount, behavior: 'smooth' });
            }
        }

        function setupSlides() {
            const stage = document.getElementById('stage-3d');
            stage.innerHTML = '';

            pageSlides.forEach((slide, index) => {
                const el = document.createElement('div');
                el.className = 'page-slide-3d';
                const gridHtml = `<div class="slide-cyber-grid"></div>`;
                const cornerDeco = `<div class="corner-deco corner-tl"></div><div class="corner-deco corner-br"></div>`;
                el.innerHTML = gridHtml + cornerDeco; 

                if (slide.stamp) {
                    const stamp = document.createElement('div');
                    stamp.className = 'stamp-overlay';
                    stamp.innerText = slide.stamp;
                    el.appendChild(stamp);
                }

                const contentWrap = document.createElement('div');
                contentWrap.className = 'slide-content-wrap';
                
                if(slide.title.includes("MAIN_COURSES")) {
                    contentWrap.style.padding = "20px 0";
                    contentWrap.style.display = "flex";
                    contentWrap.style.flexDirection = "column";
                }

                let html = `<h3 class="slide-header" style="margin:0 20px 10px 20px;">${slide.title}</h3>`;
                html += slide.content;
                contentWrap.innerHTML = html;
                el.appendChild(contentWrap);
                stage.appendChild(el);
                
                if (slide.title.includes("MAIN_COURSES")) {
                    const gridContainer = contentWrap.querySelector('#menu-scroll-container');
                    if(gridContainer) {
                        renderMenu(gridContainer);
                    }
                }
                el._baseIndex = index;
                
                const textElements = contentWrap.querySelectorAll('.type-me');
                textElements.forEach(elem => { elem.dataset.originalHtml = elem.innerHTML; elem.innerHTML = ''; elem.classList.add('pre-type-hidden'); });
            });
        }

        async function runBillAnimation() {
            if(billAnimationPlayed) return;
            billAnimationPlayed = true;
            
            const tbody = document.getElementById('bill-table-body');
            const tfoot = document.getElementById('bill-table-foot');
            if(!tbody) return;
            
            tbody.innerHTML = ''; 
            
            for (let i = 0; i < billData.length; i++) {
                const item = billData[i];
                const row = document.createElement('tr');
                const cellItem = document.createElement('td');
                const cellLegacy = document.createElement('td');
                const cellPrice = document.createElement('td');
                
                cellLegacy.className = "strike-red"; 
                cellPrice.style.color = "var(--success)";
                
                row.appendChild(cellItem);
                row.appendChild(cellLegacy);
                row.appendChild(cellPrice);
                tbody.appendChild(row);
                
                await typeText(cellItem, item.item);
                
                if(item.isText) {
                    await typeText(cellLegacy, item.legacy);
                } else {
                    await countNumber(cellLegacy, item.legacy, item.isMoney, item.suffix);
                }
                
                if(item.isText) {
                    await typeText(cellPrice, item.price);
                } else {
                    await countNumber(cellPrice, item.price, item.isMoney, item.suffix);
                }
            }
            if(tfoot) tfoot.style.display = 'table-row-group';
        }

        function typeText(element, text) {
            return new Promise(resolve => {
                element.classList.add('table-type-cursor');
                let i = 0;
                const interval = setInterval(() => {
                    element.innerText = text.substring(0, i + 1);
                    i++;
                    if (i === text.length) {
                        clearInterval(interval);
                        element.classList.remove('table-type-cursor');
                        resolve();
                    }
                }, 30);
            });
        }

        function countNumber(element, targetVal, isMoney, suffix = '') {
            return new Promise(resolve => {
                let start = 0;
                const end = parseInt(targetVal);
                const duration = 500;
                const startTime = performance.now();

                function update(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const currentVal = Math.floor(progress * end);
                    let displayStr = isMoney ? '$' + currentVal.toLocaleString() : currentVal + suffix;
                    
                    element.innerText = displayStr; 

                    if (progress < 1) {
                        requestAnimationFrame(update);
                    } else {
                        element.innerHTML = displayStr.replace(/0/g, '<span class="blink-zero">0</span>');
                        resolve();
                    }
                }
                requestAnimationFrame(update);
            });
        }

        function typeWriter(element) {
            if(element.dataset.typing === "true" || element.dataset.typing === "finished") return;
            element.dataset.typing = "true";
            const fullHtml = element.dataset.originalHtml;
            element.innerHTML = '';
            element.classList.remove('pre-type-hidden');
            element.classList.add('typing-cursor');
            let i = 0;
            const speed = 10;
            function type() {
                if(!element.closest('.active')) { element.innerHTML = ''; element.dataset.typing = "false"; return; }
                if (fullHtml.charAt(i) === '<') {
                    const endTag = fullHtml.indexOf('>', i);
                    if (endTag !== -1) { element.innerHTML += fullHtml.substring(i, endTag + 1); i = endTag + 1; }
                } else { element.innerHTML += fullHtml.charAt(i); i++; }
                if (i < fullHtml.length) { setTimeout(type, speed); } 
                else { 
                    element.dataset.typing = "finished"; 
                    const slide = element.closest('.page-slide-3d');
                    const stamp = slide.querySelector('.stamp-overlay');
                    if(stamp) stamp.classList.add('stamp-animate');
                }
            }
            type();
        }

        function triggerSlideAnimations(slide) {
            const textElements = slide.querySelectorAll('.type-me');
            textElements.forEach((elem, index) => { setTimeout(() => { typeWriter(elem); }, index * 200 + 300); });
            
            const buttons = slide.querySelectorAll('.cyber-btn-animated');
            buttons.forEach(btn => {
                btn.classList.remove('visible');
                void btn.offsetWidth;
                btn.classList.add('visible');
            });

            if(slide.querySelector('#bill-table-body')) {
                setTimeout(runBillAnimation, 500);
            }
        }

        function resetSlideAnimations(slide) {
            const textElements = slide.querySelectorAll('.type-me');
            textElements.forEach((elem, index) => { elem.dataset.typing = "false"; elem.innerHTML = ''; elem.classList.add('pre-type-hidden'); });
            const stamp = slide.querySelector('.stamp-overlay');
            if(stamp) stamp.classList.remove('stamp-animate');
            
            const buttons = slide.querySelectorAll('.cyber-btn-animated');
            buttons.forEach(btn => {
                btn.classList.remove('visible');
            });
        }

        function update() {
            const slides = document.querySelectorAll('.page-slide-3d');
            slides.forEach(slide => {
                let z = (slide._baseIndex * spacing) + virtualScroll;
                const offset = 50000 * loopDistance; z = (z + offset) % loopDistance;
                if (z > spacing) z -= loopDistance;
                const distance = Math.abs(z);
                let opacity = 1;
                if (z > 300) opacity = 0; else if (z < -1500) opacity = 0; else { opacity = 1 - Math.min(1, Math.max(0, (distance - 200) / 1000)); }
                let scale = 1; let rotateX = 0;
                if (z < 0) { rotateX = Math.max(-15, z / 50); }
                slide.style.transform = `translate3d(-50%, -50%, ${z}px) rotateX(${rotateX}deg) scale(${scale})`;
                slide.style.opacity = opacity;
                
                slide.style.zIndex = 10000 - Math.floor(distance);
                
                if (z > -100 && z < 100) {
                    if (!slide.classList.contains('active')) {
                        slide.classList.add('active');
                        slide.style.pointerEvents = 'auto';
                        triggerSlideAnimations(slide);
                    }
                } else {
                    if (slide.classList.contains('active')) {
                        slide.classList.remove('active');
                        slide.style.pointerEvents = 'none';
                        resetSlideAnimations(slide);
                    }
                }
            });
            requestAnimationFrame(update);
        }

        function handleScroll(direction) {
            if (isScrollLocked) return;
            isScrollLocked = true;
            currentSlideIndex += direction;
            setTimeout(() => { isScrollLocked = false; }, 600); 
        }

        // SCROLL & TOUCH HANDLERS (Improved for mixed content scroll)
        
        window.addEventListener('wheel', (e) => { 
            // If we are over the menu container (even if bubbling), don't change slides
            const gallery = e.target.closest('.menu-scroll-container');
            
            if (gallery) {
                // Manually handle the mapping: Vertical Wheel -> Horizontal Gallery Scroll
                gallery.scrollLeft += e.deltaY;
                return; // Stop here, do not trigger page scroll
            }

            // Check if scrolling inside other content (e.g. modal)
            const scrollable = e.target.closest('.slide-content-wrap, .modal-content, .card-desc');
            if (scrollable) {
                 const canScrollUp = scrollable.scrollTop > 0;
                 const canScrollDown = scrollable.scrollTop + scrollable.clientHeight < scrollable.scrollHeight;

                 if ((canScrollUp && e.deltaY < 0) || (canScrollDown && e.deltaY > 0)) {
                     return; 
                 }
            }
            
            if (e.deltaY > 0) handleScroll(-1); else handleScroll(1);
        }, {passive: false});
        
        let touchStartX = 0, touchStartY = 0;
        window.addEventListener('touchstart', e => { touchStartY = e.touches[0].clientY; touchStartX = e.touches[0].clientX; lastTouchTime = new Date().getTime(); }, {passive: false});
        window.addEventListener('touchmove', e => {
            const deltaY = touchStartY - e.touches[0].clientY;
            
            // Critical Fix: If touching the gallery, do not change slides!
            if (e.target.closest('.menu-scroll-container')) {
                e.stopPropagation();
                return;
            }

            const scrollable = e.target.closest('.slide-content-wrap, .card-desc, .modal-content');
            if (scrollable) {
                 const canScrollUp = scrollable.scrollTop > 0;
                 const canScrollDown = Math.ceil(scrollable.scrollTop + scrollable.clientHeight) < scrollable.scrollHeight;

                 if ((canScrollUp && deltaY < 0) || (canScrollDown && deltaY > 0)) {
                     e.stopPropagation(); 
                     return; 
                 }
            }

            if(e.cancelable) e.preventDefault(); 
            
            if (Math.abs(deltaY) > 50) { 
                if (deltaY > 0) handleScroll(1); else handleScroll(-1); 
                touchStartY = e.touches[0].clientY; 
            }
        }, {passive: false});

        function animateScroll() {
            const targetVirtualScroll = -currentSlideIndex * spacing;
            virtualScroll += (targetVirtualScroll - virtualScroll) * 0.08;
            requestAnimationFrame(animateScroll);
        }

        // Idle Timer with Pop-out Logic
        let idleTimer;
        function resetIdleTimer() {
            const icons = document.querySelectorAll('.side-icon-container i, .cyber-chart-large');
            icons.forEach(el => el.classList.remove('idle-pop'));
            
            const el = document.getElementById('scroll-instruction');
            el.classList.remove('visible'); 
            
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => { 
                el.classList.add('visible'); 
                icons.forEach(el => el.classList.add('idle-pop'));
            }, 3000);
        }
        window.addEventListener('mousemove', resetIdleTimer);
        window.addEventListener('scroll', resetIdleTimer);
        window.addEventListener('touchstart', resetIdleTimer);
        window.addEventListener('wheel', resetIdleTimer);

        window.onload = () => {
            setupSlides();
            animateScroll(); 
            update();
            resetIdleTimer();
        };

        function handleDoubleTap() {}
    </script>
</body>
</html>